name: Super Linter

on:
    push:
        branches: [main, master]
    pull_request:
        branches: [main, master]

jobs:
    lint:
        name: Check for Linting
        runs-on: ubuntu-latest
        permissions:
            contents: read
        steps:
            - name: Checkout code
              uses: actions/checkout@v4.2.2
              with:
                  fetch-depth: 0

            - name: Run Super-Linter
              uses: super-linter/super-linter@v7.3.0
              env:
                  VALIDATE_ALL_CODEBASE: false
                  DEFAULT_BRANCH: master
                  VALIDATE_CSHARP: true
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    fix-lint-issues:
        name: Fix Linting
        needs: lint
        permissions:
            # To write linting fixes
            contents: write
            # To write Super-linter status checks
            statuses: write
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4.2.2
              with:
                  fetch-depth: 0

            - name: Super-Linter Fix
              uses: super-linter/super-linter@v7.3.0
              env:
                  VALIDATE_ALL_CODEBASE: false
                  DEFAULT_BRANCH: master
                  VALIDATE_CSHARP: true
                  FIX_CSHARP: true
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            - name: Commit and push linting fixes
              # Run only on:
              # - Pull requests
              # - Not on the default branch
              if: >
                  github.event_name == 'pull_request' &&
                  github.ref_name != github.event.repository.default_branch
              uses: stefanzweifel/git-auto-commit-action@v5
              with:
                  branch: ${{ github.event.pull_request.head.ref || github.head_ref || github.ref }}
                  commit_message: "chore: fix linting issues"
                  commit_user_name: super-linter
                  commit_user_email: super-linter@super-linter.dev
